<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Cocker Map with Feed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <style>
    html, body { height: 100%; margin: 0; display: flex; font-family: sans-serif; }
    #map { flex: 1; }
    #feed {
      width: 300px;
      background: #f9f9f9;
      overflow-y: auto;
      border-left: 2px solid #ccc;
      padding: 10px;
    }
    .entry {
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
      padding-bottom: 6px;
    }
    .entry strong { font-size: 16px; }
    .entry .ad, .entry .suggestion, .entry .social {
      font-size: 14px;
      margin-top: 2px;
    }
    .entry .social {
      color: #2d72d9;
    }
  </style>
</head>
<body>
<div id="map"></div>
<div id="feed"><h3>Activity Feed</h3></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script>
  const map = L.map('map').setView([37.0902, -95.7129], 4);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.Control.geocoder({ defaultMarkGeocode: true }).addTo(map);

  const rankLabels = {
    1: "Got a number",
    2: "Flirted hard",
    3: "Got a kiss",
    4: "Woke up together",
    5: "Got laid"
  };

  const rankEmojis = {
    1: "üçÇ",
    2: "üòâ",
    3: "üíã",
    4: "‚òï",
    5: "üî•"
  };

  const fakeAds = [
    "2-for-1 shots at Sloppy Jack‚Äôs!",
    "Free app with any cocktail at Tipsy Turtle.",
    "Half-price margs tonight at The Broken Boot.",
    "Get lit with $3 Long Islands at Club Nectar!",
    "Ladies drink free before 10 at Rattle & Hum."
  ];

  const nearbyNames = [
    "Lucky Larry‚Äôs",
    "Velvet Vibe Lounge",
    "The Sweaty Peach",
    "Motel Mirage",
    "The Moonlit Taproom"
  ];

  const socials = [
    "on Instagram",
    "on TikTok",
    "on Threads",
    "on Facebook",
    "on OnlyFans"
  ];

  function getRandomAd() {
    return fakeAds[Math.floor(Math.random() * fakeAds.length)];
  }

  function getRandomNearby(latlng) {
    let points = [];
    for (let i = 0; i < 2; i++) {
      let offsetLat = (Math.random() - 0.5) * 0.02;
      let offsetLng = (Math.random() - 0.5) * 0.02;
      points.push({
        name: nearbyNames[Math.floor(Math.random() * nearbyNames.length)],
        lat: latlng.lat + offsetLat,
        lng: latlng.lng + offsetLng
      });
    }
    return points;
  }

  function getFakeSocial(name) {
    const handle = name.toLowerCase().replace(/[^a-z]/g, '');
    const network = socials[Math.floor(Math.random() * socials.length)];
    return `@${handle} ${network}`;
  }

  function addToFeed(emoji, label, ad, suggestion1, suggestion2) {
    const feed = document.getElementById("feed");
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `
      <strong>${emoji} ${label}</strong>
      <div class="ad">${ad}</div>
      <div class="suggestion">Try: ${suggestion1.name}</div>
      <div class="suggestion">Or: ${suggestion2.name}</div>
      <div class="social">${getFakeSocial(suggestion1.name)}</div>
    `;
    feed.prepend(div);
  }

  function addRankedMarker(latlng) {
    const popupDiv = document.createElement('div');
    popupDiv.className = 'rank-popup';
    popupDiv.innerHTML = '<strong>What happened here?</strong>';

    for (let i = 1; i <= 5; i++) {
      const btn = document.createElement('button');
      btn.textContent = `${rankEmojis[i]} ${rankLabels[i]}`;
      btn.onclick = () => {
        const ad = getRandomAd();
        const suggestions = getRandomNearby(latlng);
        const icon = L.divIcon({
          className: 'custom-icon',
          html: `<div style="font-size: 28px;">${rankEmojis[i]}</div>`,
          iconSize: [30, 30],
          iconAnchor: [15, 15]
        });

        const marker = L.marker(latlng, { icon }).addTo(map);
        const popupHTML = `
          <div class="popup-content">
            <strong>${rankEmojis[i]} ${rankLabels[i]}</strong><br>
            <div class="ad">${ad}</div>
            <div class="suggestion">Also try: ${suggestions[0].name}</div>
            <div class="suggestion">Or maybe: ${suggestions[1].name}</div>
          </div>`;
        marker.bindPopup(popupHTML).openPopup();

        // Drop suggested spots
        suggestions.forEach(s => {
          L.circleMarker([s.lat, s.lng], {
            radius: 6,
            fillColor: "#2ecc71",
            color: "#2ecc71",
            fillOpacity: 0.8,
            weight: 1
          })
          .addTo(map)
          .bindPopup(`Suggested spot: ${s.name}`);
        });

        addToFeed(rankEmojis[i], rankLabels[i], ad, suggestions[0], suggestions[1]);
        map.closePopup();
      };
      popupDiv.appendChild(btn);
    }

    L.popup()
      .setLatLng(latlng)
      .setContent(popupDiv)
      .openOn(map);
  }

  map.on('click', function(e) {
    addRankedMarker(e.latlng);
  });
</script>
</body>
</html>
